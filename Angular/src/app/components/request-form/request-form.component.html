<div class="card p-6">
  <h1>
    {{ isEditMode ? "Edit Request" : "Request Details" }}
  </h1>

  <!-- Grid Layout (Responsive) -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Left Section: Request Details -->
    <div class="flex flex-col gap-4">
      <p-floatlabel variant="in">
        <label for="name" class="block font-semibold">Name</label>
        <input
          id="name"
          pInputText
          [(ngModel)]="request.name"
          class="w-full"
          [disabled]="isViewMode"
        />
      </p-floatlabel>

      <p-floatlabel variant="in">
        <label for="budget" class="block font-semibold">Budget</label>
        <input
          id="budget"
          pInputText
          [(ngModel)]="request.budget"
          class="w-full"
          [disabled]="isViewMode"
        />
      </p-floatlabel>

      <p-floatlabel variant="in">
        <textarea
          pTextarea
          id="comment"
          [(ngModel)]="request.comment"
          rows="5"
          cols="30"
          style="resize: none"
          class="h-full"
          [disabled]="isViewMode"
        ></textarea>
        <label for="comment">Special comment about the request</label>
      </p-floatlabel>

      <p-floatlabel variant="in">
        <div class="w-full">
          <p-datepicker
            id="targetDate"
            [(ngModel)]="request.targetDate"
            [showIcon]="true"
            inputId="buttondisplay"
            [showOnFocus]="false"
            class="w-full"
            [disabled]="isViewMode"
            dateFormat="yy-mm-dd"
          ></p-datepicker>
          <label for="targetDate" class="block font-semibold"
            >Target Date</label
          >
        </div>
      </p-floatlabel>
    </div>

    <!-- Right Section: STL Preview -->
    <div class="stl-section flex flex-col items-center">
      <div class="stl-placeholder">
        <p>STL preview here</p>
      </div>

      <div class="stl-actions flex gap-2 mt-4">
        <p-button
          *ngIf="!isEditMode"
          label="Download file"
          icon="pi pi-download"
          class="p-button-outlined flex-1"
        ></p-button>
        <p-fileUpload
          *ngIf="isEditMode"
          mode="basic"
          customUpload
          (uploadHandler)="uploadFile($event)"
          accept=".stl"
          chooseLabel="Upload file"
          class="flex-1"
        ></p-fileUpload>
      </div>
    </div>
  </div>

  <div style="display: flex" class="justify-between items-center mt-6">
    <h3 class="text-lg font-semibold self-center" style="margin-right: 10px">
      {{ request.presets.length }} Presets Recommended
      <p-button
        id="add-preset"
        *ngIf="isEditMode || isNewMode"
        label="Add Preset"
        [link]="true"
        icon="pi pi-plus"
        (click)="addPreset()"
      ></p-button>
    </h3>
  </div>

  <p-table
    [value]="request.presets"
    dataKey="id"
    [tableStyle]="{ 'min-width': '50rem' }"
  >
    <ng-template #header>
      <tr>
        <th>Printer</th>
        <th>Filament Type</th>
        <th>Color</th>
        <th>Print Quality</th>
        <th *ngIf="isEditMode" style="width: 10%">Actions</th>
      </tr>
    </ng-template>

    <ng-template #body let-preset let-ri="rowIndex">
      <tr>
        <!-- Printer -->
        <td>
          <p-dropdown
            [(ngModel)]="preset.printer"
            [options]="printers"
            placeholder="Select Printer"
            [disabled]="isViewMode"
            appendTo="body"
          ></p-dropdown>
        </td>

        <!-- Filament Type -->
        <td>
          <p-dropdown
            [(ngModel)]="preset.filamentType"
            [options]="filamentTypes"
            placeholder="Select Filament"
            [disabled]="isViewMode"
            appendTo="body"
          ></p-dropdown>
        </td>

        <!-- Color -->
        <td>
          <p-dropdown
            [(ngModel)]="preset.color"
            [options]="colors"
            placeholder="Select Color"
            [disabled]="isViewMode"
            appendTo="body"
          ></p-dropdown>
        </td>

        <!-- Print Quality -->
        <td>
          <p-dropdown
            [(ngModel)]="preset.printQuality"
            [options]="printQualities"
            placeholder="Select Quality"
            [disabled]="isViewMode"
            appendTo="body"
          ></p-dropdown>
        </td>

        <!-- Delete Button -->
        <td *ngIf="isEditMode">
          <button
            pButton
            pRipple
            type="button"
            icon="pi pi-trash"
            class="p-button-rounded p-button-danger"
            (click)="removePreset(ri)"
            severity="danger"
            appendTo="body"
          ></button>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <div class="flex justify-end mt-6 gap-3 edit-actions" *ngIf="isViewMode">
    <!-- make an offer button -->
    <div class="flex justify-end">
      <button
        pButton
        pRipple
        type="button"
        label="Make an Offer"
        icon="pi pi-money-bill"
        class="p-button-info"
        (click)="makeAnOffer()"
        severity="info"
        appendTo="body"
      ></button>
    </div>
  </div>

  <div class="flex justify-end mt-6 gap-3 edit-actions" *ngIf="isEditMode">
    <p-button
      label="Cancel"
      icon="pi pi-times"
      severity="secondary"
      (click)="cancelEdit()"
    ></p-button>
    <p-button
      label="Delete"
      icon="pi pi-trash"
      severity="danger"
      (click)="deleteRequest()"
    ></p-button>
    <p-button
      label="Save"
      icon="pi pi-save"
      severity="success"
      (click)="saveChanges()"
    ></p-button>
  </div>
</div>
